<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Malette</title>
</head>
  <script src="../pixi/pixi.min.js"></script>
  <script src="../pixi/pixi-sound.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="js/constants.js"></script>
  <script src="js/imgsnd.js"></script>
  <script src="js/Timer.js"></script>
  <script src="js/Keyboardread.js"></script>
  <script src="js/PAnalyze.js"></script>
  <script src="js/Styles.js"></script>
  <script src="js/GameStates.js"></script>
<body>
  <body bgcolor="#000000">

  <script type="text/javascript">
    let type = "WebGL"
    if(!PIXI.utils.isWebGLSupported()){
      type = "canvas"
    }



    function gameprogress() {
	  this.level = -1;
	}
	gameprogress.prototype.getstring = function () {
	  switch (this.level) {
		  case 0: return TEXT_LEVEL0;
		  case 1: return TEXT_LEVEL1;
		  case 2: return TEXT_LEVEL2;
		  case 3: return TEXT_LEVEL3;
		  case 4: return TEXT_LEVEL4;
		  case 5: return TEXT_LEVEL5;
		  case 6: return TEXT_LEVEL6;
		  case 7: return TEXT_LEVEL7;
		  default : return ;
		}
	}
	
	
	
    // Hour function
    function heure() {
      var date = new Date();
  	  return date.getHours() + " " + date.getMinutes() + " " + date.getSeconds();
	}
	


      	
    // Game riddles
    const MAXLEVEL = 2; // This indicates how many riddles must be solved to win
    var riddles = new Map();// key is the password, value is 0 if not found.  
    riddles.set("THESEE",0);
    riddles.set("MORT",0);
    riddles.set("25362",0);
    riddles.set("SERPENT PYTHON",0);
    riddles.set("TRENTE TROIS",0);
    riddles.set("CHAT",0);
    riddles.set("IL EST DEMENT",0);
    riddles.set("XXX=30",0);        	
	

    //// KEYBOARD READER /////////////////////////////////////////////////
    //let keyreader = Keyboardread();
    //keyreader.press = () => {
      //if (keyreader.code == KRETURN) {
	 	////PAnalyze(promptText.text);
	 	//consolePrompt.command(promptText.text);
        //promptText.text = PS1+CCURSOR;
	    //returnsound.play();
  	  //}
  	  //else if (keyreader.code == KUPARROW) {
		//promptText.text = PS1+consolePrompt.lastcommand+CCURSOR;
	  //}
	  //else if (keyreader.code == KDOWNARROW) {
		//promptText.text = PS1+CCURSOR;
	  //}
	  //else if (keyreader.code != KBACKSPACE) {
		//promptText.text = promptText.text.slice(0, promptText.text.length-1) + String.fromCharCode(keyreader.code)+CCURSOR;
		//clicksound.play();
      //}
	  //else if ((keyreader.code == KBACKSPACE) && (promptText.text.length > 3)) {
	    //promptText.text = promptText.text.slice(0, promptText.text.length-2) + CCURSOR;
	    //backspacesound.play();
	  //}
	  //else {
      //}
	//}

      	
	let state;
	
	var app = new PIXI.Application(800,600,{backgroundColor: 0x0} );
	document.body.appendChild(app.view);
	


	
	var timer = new Timer();
	var consolePrompt = new PAnalyze();
    var debugmode = 0 ; 
    var debugrequest = 0;
    var securitylevel = new gameprogress();

    
    let backgroundimg = new PIXI.Sprite.fromImage(img4[0]);    
    backgroundimg.setTransform(-20,-30,img4[1],img4[2]);
   
    // Add elements to canvas

    app.stage.addChild(backgroundimg);
    app.stage.addChild(timerText);
	app.stage.addChild(promptText);
	app.stage.addChild(consoleText);
	app.stage.addChild(debugText);
	app.stage.addChild(securitylevelText);

    PIXI.sound.stopAll;
	// init timer with saved values if they exist
	timer.restore();   

    //Set the game state (play, win, lose)
    if (timer.isrunning == 0) {state = intro;} else {state = play;}
 
    //Start the game loop 
    app.ticker.add(delta => gameLoop(delta));
    
	function gameLoop(delta){
	  //Update the current game state:
	  state(delta);
	}
	

  </script>
</body>
</html>
