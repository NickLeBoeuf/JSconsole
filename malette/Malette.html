<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Malette</title>
  <style>
    html, body {
      width: 100%;
      height: 100%;
      margin: 0px;
      border: 0;
      resize: 1;
      overflow: hidden; /*  Disable scrollbars */
      display: block;  /* No floating content on sides */
    }
    </style>
</head>
  <script src="../pixi/pixi.min.js"></script>
  <script src="../pixi/pixi-sound.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="js/constants.js"></script>
  <script src="js/imgsnd.js"></script>
  <script src="js/Timer.js"></script>
  <script src="js/Keyboardread.js"></script>
  <script src="js/PAnalyze.js"></script>
  <script src="js/Styles.js"></script>
  <script src="js/GameStates.js"></script>
<body>
  <body bgcolor="#000000">

  <script type="text/javascript">
    let type = "WebGL"
    if(!PIXI.utils.isWebGLSupported()){
      type = "canvas"
    }


    function gameprogress() {
	  this.level = -1;
	}
	gameprogress.prototype.getstring = function () {
	  switch (this.level) {
		  case 0: return TEXT_LEVEL0;
		  case 1: return TEXT_LEVEL1;
		  case 2: return TEXT_LEVEL2;
		  case 3: return TEXT_LEVEL3;
		  case 4: return TEXT_LEVEL4;
		  case 5: return TEXT_LEVEL5;
		  case 6: return TEXT_LEVEL6;
		  case 7: return TEXT_LEVEL7;
		  default : return ;
		}
	}
	
    // Hour function
    function heure() {
      var date = new Date();
  	  return date.getHours() + " " + date.getMinutes() + " " + date.getSeconds();
	}
	
	
	// TODO: clean game riddles section
	// TODO: the timer x,y,scale is not linked to the resize window
	
	// TODO: The app does not work with Chrome, pb of loader - constants is not load before execution of html
	// TODO: Progress bar with a rectangle on the right side of the screen to visually see the timer
	
	
      	
    // Game riddles
    const MAXLEVEL = 2; // This indicates how many riddles must be solved to win
    var riddles = new Map();// key is the password, value is 0 if not found.  
    riddles.set("THESEE",0);
    riddles.set("MORT",0);
    riddles.set("25362",0);
    riddles.set("SERPENT PYTHON",0);
    riddles.set("TRENTE TROIS",0);
    riddles.set("CHAT",0);
    riddles.set("IL EST DEMENT",0);
    riddles.set("XXX=30",0);        	
	
      	
	let state;
	
	var app = new PIXI.Application({width:WIDTH,height:HEIGHT,backgroundColor: 0,
	 //resolution: window.devicePixelRatio || 1,
     autoResize : true});
	document.body.appendChild(app.view);
	
    const container = new PIXI.Container();
    container.x = 0;
    container.y = 0;
    
	
	var timer = new Timer();
	var consolePrompt = new PAnalyze();
    var debugmode = 0 ; 
    var debugrequest = 0;
    var securitylevel = new gameprogress();
    var tiltdirection = -1;
    //var panicmode = 0;
    var tolkien = -1;
    var morsecode = 0;
    var morsemessage;
    var morsemaxcnt;
    var morsecnt;
    var morseletter; 
    var morsechar;
    var morsecode; 
     
     
    let backgroundimg = new PIXI.Sprite.from(img6[0]);    
    backgroundimg.setTransform(-20,-30,img6[1],img6[2]);
    backgroundimg.tint = "0xFFFFFF";
   
   

    // Add elements to canvas
    app.stage.addChild(container);
    
    //app.stage.addChild(backgroundimg);
    //app.stage.addChild(timerText);
	//app.stage.addChild(promptText);
	//app.stage.addChild(consoleText);
	//app.stage.addChild(debugText);
	//app.stage.addChild(securitylevelText);

    container.addChild(backgroundimg);    app.stage.addChild(timerText);
	container.addChild(promptText);
	container.addChild(consoleText);
	container.addChild(debugText);
	container.addChild(securitylevelText);
  
    PIXI.sound.stopAll();
    PIXI.sound.stopAll();
	// init timer with saved values if they exist
	timer.restore();   

    //Set the game state (play, win, lose)
    if (timer.isrunning == 0) {state = intro;} else {state = play;}
 
 
    //container.scale.x = 2;
    //Start the game loop 
    app.ticker.add(delta => gameLoop(delta));
    
	function gameLoop(delta){
	  //Update the current game state:
	  state(delta);
	}
	
    window.addEventListener('resize', resize);

    function resize() {

	// Get the parent
	const parent = app.view.parentNode;
   
	// Resize the renderer
	app.renderer.resize(parent.clientWidth, parent.clientHeight);
    container.scale.x = app.screen.width/WIDTH;
    container.scale.y = app.screen.height/HEIGHT;
    //console.log(parent.clientHeight);
    }

resize();	
	

  </script>
</body>
</html>
